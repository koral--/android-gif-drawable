env:
  global:
    - MALLOC_ARENA_MAX=2

sudo: true

language:
  - android

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - libstdc++-4.9-dev
      - oracle-java8-installer

licenses:
  - '*'

android:
  components:
    - tools # to get the new `repository-11.xml`
    - tools # see https://github.com/travis-ci/travis-ci/issues/6040#issuecomment-219367943)

jdk:
  - oraclejdk8

before_install:
  - export PATH=${PATH}:${ANDROID_HOME}/tools/bin
  - mkdir -p ${ANDROID_HOME}/licenses
  - echo 8933bad161af4178b1185d1a37fbf41ea5269c55 > ${ANDROID_HOME}/licenses/android-sdk-license
  - sdkmanager "tools" "platform-tools" "build-tools;26.0.0" "platforms;android-24" "platforms;android-26" "ndk-bundle" "extras;android;m2repository" "system-images;android-24;google_apis;armeabi-v7a"
  - export ANDROID_NDK_HOME=${ANDROID_HOME}/ndk-bundle

before_script:
  - echo n | ${ANDROID_HOME}/tools/bin/avdmanager create avd --force --name emulator --abi armeabi-v7a --package "system-images;android-24;google_apis;armeabi-v7a"
  - pushd ${ANDROID_HOME}/tools
  - emulator @emulator -no-window -gpu off -no-audio &
  - popd
  - android-wait-for-emulator
  - adb shell wm dismiss-keyguard

script:
  - ./gradlew build connectedCheck :android-gif-drawable:jacocoTestReport --scan

after_script:
 - cat android-gif-drawable/build/outputs/lint-results-debug.xml
 - adb logcat -d

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
